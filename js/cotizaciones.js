const crearMascara=()=>{$(".precioClase").mask("000,000,000,000,000.00",{reverse:!0})},brProyectoToLocalS=async e=>{let o=await $.ajax("empleados/php/ObtenerProyecto.php");localStorage.setItem("proyectos",o),fillSelectProyectos("r",e)},loader=()=>{Swal.fire({title:"Please Wait!",html:"Loading data",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}})},AlertaExito=()=>{Swal.fire("Good job!","Data Inserted","success")};let contador=1;const imprimirCategoria=()=>{contador++;let e=`\n  <div class="card cate${contador}">\n    <div class="card-body works${contador}" >\n        <div class="row justify-content-start">\n            <div class="col-md-3 col-sm-3"> <label for="type">Job categories</label> <select name="type[]" REQUIRED id="type${contador}"\n                    class="form-control">\n\n<option value="Wall Repairs">Wall Repairs</option>\n<option value="Painting Walls">Painting Walls</option>\n<option value="Painting Walls and Trim">Painting Walls and Trim</option>\n<option value="Painting of other items">Painting of other items</option>\n<option value="Painting of Ceilings">Painting of Ceilings</option>\n<option value="Drywall installation">Drywall installation</option>\n<option value="Ceiling Repair ">Ceiling Repair </option>\n<option value="Ceiling Texturing">Ceiling Texturing</option>\n<option value="Demolition">Demolition</option>\n<option value="Plumbing">Plumbing</option>\n<option value="Tile Installation-Floor">Tile Installation-Floor</option>\n<option value="Tile Installation-Backsplash">Tile Installation-Backsplash</option>\n<option value="Baseboard installation">Baseboard installation</option>\n<option value="Floor Installation">Floor Installation</option>\n<option value="Ceiling Repair">Ceiling Repair</option>\n<option value="Miscellaneous">Miscellaneous</option>\n<option value="Colour Consulting">Colour Consulting</option>\n<option value="Garbage Removal">Garbage Removal</option>\n                </select>\n            </div>\n            <div class="col-md-2 col-sm-2"> <label for="precio">Price</label>\n                <div class="input-group mb-3">\n                    <div class="input-group-prepend"> <span class="input-group-text">$</span> </div> <input type="text"\n                        class="form-control precioClase" REQUIRED name="price[]" >\n                </div>\n            </div>\n            <div class="col-md-1">\n                    <label for="place">Delete category</label>  <a class="btn btn-danger text-white " onclick="deleteCategoria(${contador})" ><i class="fas fa-folder-minus"></i></a>\n            </div>\n        </div>\n        <div class="row justify-content-end">\n            <label class="col-sm-1 col-form-label">Work</label>\n               <div class="col-sm-5">\n                 <textarea\n                    class="form-control" REQUIRED name="work[]" rows="1"></textarea>\n               </div>\n               <div class="col-sm-1">\n                    <a class="btn btn-info btn-sm btnAddrWork text-white" id="btnAddrWork${contador}"\n                    data-turno="${contador}" data-turnoW="1">Add work</a>\n               </div> \n        </div>\n\n    </div>\n</div>\n  `;$("#categorias").append(e),crearMascara()},imprimirFila=e=>{let o=`\n<div class="form-row zone">\n    <div class="col-md-11"> <label for="place"> Work Zone</label> <input type="text" REQUIRED id="place" name="place" class="form-control">\n    </div>\n    <div class="col-md-1 "><label for="place">Add Category</label>  <a class="btn btn-success text-white " onclick="imprimirCategoria()" ><i class="fas fa-folder-plus"></i></a>\n    </div>\n</div>\n<div id="categorias" class='zone'>\n<div class="card">\n    <div class="card-body works${e}">\n        <div class="row justify-content-start">\n            <div class="col-md-3 col-sm-3"> <label for="type">Job categories</label> <select name="type[]" REQUIRED id="type"\n                    class="form-control">\n\n<option value="Wall Repairs">Wall Repairs</option>\n<option value="Painting Walls">Painting Walls</option>\n<option value="Painting Walls and Trim">Painting Walls and Trim</option>\n<option value="Painting of other items">Painting of other items</option>\n<option value="Painting of Ceilings">Painting of Ceilings</option>\n<option value="Drywall installation">Drywall installation</option>\n<option value="Ceiling Repair ">Ceiling Repair </option>\n<option value="Ceiling Texturing">Ceiling Texturing</option>\n<option value="Demolition">Demolition</option>\n<option value="Plumbing">Plumbing</option>\n<option value="Tile Installation-Floor">Tile Installation-Floor</option>\n<option value="Tile Installation-Backsplash">Tile Installation-Backsplash</option>\n<option value="Baseboard installation">Baseboard installation</option>\n<option value="Floor Installation">Floor Installation</option>\n<option value="Ceiling Repair">Ceiling Repair</option>\n<option value="Miscellaneous">Miscellaneous</option>\n<option value="Colour Consulting">Colour Consulting</option>\n<option value="Garbage Removal">Garbage Removal</option>\n                </select>\n            </div>\n            <div class="col-md-2 col-sm-2"> <label for="precio">Price</label>\n                <div class="input-group mb-3">\n                    <div class="input-group-prepend"> <span class="input-group-text">$</span> </div> <input type="text"\n                        class="form-control  precioClase" REQUIRED name="price[]" >\n                </div>\n            </div>\n        </div>\n        <div class="row justify-content-end " >\n               <label class="col-sm-1 col-form-label">Work</label>\n               <div class="col-sm-5">\n                 <textarea\n                    class="form-control" name="work[]" REQUIRED rows="1"></textarea>\n               </div>\n               <div class="col-sm-1">\n                    <a class="btn btn-info btn-sm btnAddrWork text-white" id="btnAddrWork${contador}"\n                    data-turno="${e}" data-turnoW="1">Add work</a>\n               </div>\n        </div>\n    </div>\n</div>\n</div>\n`;$("#rowsC").append(o)},imprimirTrabajo=e=>{let o=`\n  <div id="trabajo${e.turnow+1}C${e.turno}">\n  <hr>\n  <div class="row justify-content-end"  >\n  <label class="col-sm-1 col-form-label">Work</label>\n               <div class="col-sm-5">\n               <textarea class="form-control" REQUIRED name="work[]" rows="1"></textarea>\n               </div>\n               <div class="col-sm-1">\n                     <a class="btn btn-danger btn-sm text-white" onclick="deleteWork(${e.turnow+1},${e.turno})" >Remove Work</a>\n             </div>\n             </div>\n  </div>\n`;$(".works"+e.turno).append(o),$("#btnAddrWork"+e.turno).data("turnow",e.turnow+1)};imprimirFila(contador);const deleteCategoria=e=>{contador-=1,$(".cate"+e).remove()},deleteWork=(e,o)=>{$(`#trabajo${e}C${o}`).remove();let n=$("#btnAddrWork"+o).data("turnow");$("#btnAddrWork"+o).data("turnow",n-1)},format=async e=>{let o,n=await $.ajax("php/cotizaciones/ObtenerDatosC.php?cliente="+e.code);n=JSON.parse(n);let t='<table class="table table-stripeed table-bordered" cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">';return n.map(e=>{e.cat!==o?t+=`\n        <tr>\n        <th>${e.cat} </th>\n        <th>$ ${e.total} </th>\n        </tr> \n        <tr> <td> ${e.detalle}</td>      <td></td></tr>\n        `:t+=`\n        <tr>\n        <td>${e.detalle} </td>\n        <td></td>\n        </tr>  `,o=e.cat}),t+="</table>",t};var table;const tabla=e=>{table=$("#example").DataTable({destroy:!0,ajax:{url:"php/cotizaciones/ObtenerCotizaciones.php?cliente="+e,dataSrc:""},columns:[{className:"details-control",orderable:!1,data:null,defaultContent:""},{data:"WorkZone",name:"WorkZone"},{data:"total",name:"Total"}],order:[[1,"asc"]]})};$("#example").on("click","td.details-control",(function(){var e=$(this).closest("tr"),o=table.row(e);o.child.isShown()?(o.child.hide(),e.removeClass("shown")):format(o.data()).then(n=>{o.child(n).show(),e.addClass("shown")})})),$("#rowsC").on("click",".btnAddrWork",(function(){data=$(this).data(),imprimirTrabajo(data)})).submit((async function(e){e.preventDefault();const o=$("#ProjectSelectorCtciones").children("option:selected").val();if(validate.isEmpty(o))return alert("Debe Seleccionar proyecto");{Swal.fire({title:"Please Wait!",html:"Loading data",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}});let e=[];for(let o=1;o<=contador;o++)e.push($("#btnAddrWork"+o).data().turnow);$(".precioClase").each((function(){var e=$(this).val().replace(",","");$(this).val(e.trim())}));const n=$("#generico").val(),t=$("#clienteSelectNew").children("option:selected").val(),a=$(this).serialize();await $.ajax({url:`php/cotizaciones/insert.php?arreglo=${JSON.stringify(e)}&contador=${contador}&proyectoId=${o}&NewP=${n}&NewCliente=${t}`,type:"POST",data:a});brProyectoToLocalS(o),swal.close(),Swal.fire("Good job!","Data Inserted","success"),tabla(o),$(".zone").remove(),contador=1,imprimirFila(contador)}}));let bPCtz=!1;$("#ProjectSelectorCtciones").change(()=>{const e=$("#ProjectSelectorCtciones").children("option:selected").val();0==e?($("#newInput").removeClass("invisible").addClass("visible"),$("#newCliente").removeClass("invisible").addClass("visible"),$("#newKind").removeClass("invisible").addClass("visible")):($("#newInput").removeClass("visible").addClass("invisible"),$("#newCliente").removeClass("visible").addClass("invisible"),$("#newKind").removeClass("visible").addClass("invisible")),$(".materialesDiv").css("display","flex"),$("#btnAddMaterial").removeClass("invisible").addClass("visible"),crearMascara(),$("#mensaje").addClass("invisible"),$(".dowPart").css("display","block"),tabla(e)});let bClt=!1;$("#clienteSelectNew").hover(()=>{bClt||$.ajax({url:"php/proyecto/ObtenerClientes.php"}).done(e=>{bClt=!0,$("#clienteSelectNew").html(e)})}),$("#KindPro").change(()=>{const e=$("#KindPro").children("option:selected").val(),o=("0"+((new Date).getMonth()+1)).slice(-2);$("#generico").val(e+o)});const fillSelectProyectos=(e,o)=>{"r"===e&&($("#ProjectSelectorCtciones").find("option").remove(),$("#ProjectSelectorCtciones").append('<option disabled selected></option><option value="0">* New Project *</option>'),$(`ProjectSelectorCtciones option[value=${o}]`).attr("selected","selected"),$("#newInput").removeClass("visible").addClass("invisible"),$("#newCliente").removeClass("visible").addClass("invisible"),$("#newKind").removeClass("visible").addClass("invisible"));let n=localStorage.getItem("proyectos");n=JSON.parse(n);for(const e in n)$("#ProjectSelectorCtciones").append(`<option value="${e}">${n[e]}</option>`)},deleteThisCtz=(e,o)=>{Swal.fire({title:"Are you sure?",text:"You won't be able to revert this! ID ctz: "+e,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(n=>{if(n.value){const n=new Promise((n,t)=>{$.ajax({url:"php/cotizaciones/eliminarCtz.php?id="+e}).done(()=>{$.ajax({url:"php/cotizaciones/ObtenerCotizaciones.php",data:{cliente:o}}).done(e=>{$("#tablaMateriales").html(e),$("#dataTable").DataTable()}),n()})});Promise.all([n]).then(Swal.fire("Deleted!","Your file has been deleted.","success"))}})},generateReport=()=>{let e="php/reportes/linkCotizacion.php?projectCode="+$("#ProjectSelectorCtciones").children("option:selected").val();window.open(e,"_blank").focus()},generateReportF=()=>{let e="php/reportes/linkFactura.php?projectCode="+$("#ProjectSelectorCtciones").children("option:selected").val();window.open(e,"_blank").focus()};