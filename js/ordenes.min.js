loader=(()=>{Swal.fire({title:"Por favor, Espere",html:"Cargando Data",allowOutsideClick:!1,onBeforeOpen:()=>{Swal.showLoading()}})}),SobreValorAlerta=(()=>{Swal.fire({icon:"error",title:"Oops...",text:"Parece que no tienes en existencia la cantidad seleccionada en este producto, Verifica"})}),AlertaDeVacio=(()=>{Swal.fire({icon:"error",title:"Oops...",text:"Parece que tienes un dato necesario sin llenar, Verifica"})});let total=0,itineracion=0;fullTotal=(e=>{$("#total").text(currency(e).format())});let saveArr=[];$("#formMateriales").submit(function(e){e.preventDefault(),loader();const a=$(this).serialize().split("&"),t=$(".materiales").children("option:selected"),i=t.data().precio,l=t.data().existente,r=t.text();let c={precio:i};for(var o in a)c[a[o].split("=")[0]]=a[o].split("=")[1];if(l<c.cantidad)SobreValorAlerta();else{totalTemp=currency(c.precio).multiply(c.cantidad),saveArr[itineracion]={cantidad:c.cantidad,total:totalTemp.format(),code:t.val()};let e=`<tr data-totalr="${totalTemp}"  class="it${itineracion}" ><td><button onclick="deleteRow('${itineracion}')" class="btn "><i class="fas fa-trash"></i></button></td>   <td>${c.cantidad}</td><td>${r}</td> <td>$${c.precio}</td> <td>${totalTemp.format()}</td></tr>`;$("#tablaMateriales").append(e),total=currency(total).add(totalTemp),fullTotal(total),$("#formMateriales")[0].reset(),$(".materiales").val(null).trigger("change"),actualizarPrecios(),itineracion+=1}swal.close()}),deleteRow=(e=>{itineracion-=1,total=currency(total-$(".it"+e).data().totalr),$(".it"+e).remove(),actualizarPrecios(),fullTotal(total),saveArr.splice(e,1),console.log(saveArr)}),$("#precioCliente").change(function(){actualizarPrecios()}),$("#gridCheck").click(function(){actualizarPrecios()}),actualizarPrecios=(()=>{let e;e=$("#gridCheck").is(":checked")?$("#precioCliente").val()-.13*$("#precioCliente").val():$("#precioCliente").val(),tec=currency(.4*currency(e).subtract(total)).format(),utilidad=currency(.6*currency(e).subtract(total)).format(),$("#utilidadTec").val(tec),$("#utilidadNeta").val(utilidad)}),add=(async()=>{loader();const e=$("#cliente").children("option:selected").val(),a=$("#cliente").children("option:selected").text(),t=$("#precioCliente").val(),i=$("#tecnico").children("option:selected").val(),l=$("#utilidadNeta").val(),r=$("#utilidadTec").val(),c=$("#gridCheck").is(":checked"),o=$("#trabajoR").val(),d=$("#articulo").children("option:selected").val(),n=$("#marca").val(),s=$("#datepicker").val(),p=$("#falla").val();(0==e||0==i||validate.isEmpty(t)||validate.isEmpty(l)||validate.isEmpty(r))&&AlertaDeVacio();const u=await $.ajax({url:"php/ordenes/addMain.php?id=1",type:"POST",data:{cliente:e,precio:t,tecnico:i,uNeta:l,UTec:r,iva:c}});await Promise.all([$.ajax({url:"php/ordenes/addMain.php?id=2",type:"POST",data:{trabajo:o,articulo:d,marca:n,date:s,falla:p,query1:u}}),$.ajax({url:`php/ordenes/addMain.php?id=3&code=${u}&date=${s}&cliente=${a.trim()}`,type:"POST",data:{data:saveArr}}).done(e=>console.log(e))]);swal.close()});