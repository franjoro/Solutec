<?php
require_once('../conexion.php'); if ($_GET['filter']=='empleados'){ $sql="SELECT tb_bill.name, tb_providers.name, SUM(tb_materiales.total), tb_proyectos.name FROM `tb_materiales` INNER JOIN tb_bill ON tb_bill.code=tb_materiales.Bill INNER JOIN tb_proyectos ON tb_proyectos.code=tb_bill.projectCode INNER JOIN tb_providers ON tb_bill.providerCode=tb_providers.code "; if ($_GET['codePro']!='All'){ $sql2="WHERE tb_bill.projectCode=".$_GET['codePro']." AND " ;} else{ $sql2=" WHERE ";} $sql3=" tb_bill.date BETWEEN '".$_GET['start_date']."' AND '".$_GET['end_date']."' GROUP BY tb_bill.name "; $sql .=$sql2.$sql3; $query=mysqli_query($mysqli, $sql); $columns=array(); while ($row=mysqli_fetch_row($query)){ $columns[]=array('Name_Empleado'=>$row[0], 'TotalH'=>$row[1] ,'Salary'=>"$".number_format($row[2],2),'Salary1'=>$row[3]);} header('Content-Type:application/json'); echo json_encode($columns);} elseif ($_GET['filter']=='proyectos'){ $sql="SELECT tb_providers.name, SUM(tb_materiales.total) FROM `tb_materiales` INNER JOIN tb_bill ON tb_bill.code=tb_materiales.Bill INNER JOIN tb_providers ON tb_bill.providerCode=tb_providers.code WHERE tb_bill.date BETWEEN '".$_GET['start_date']."' AND '".$_GET['end_date']."' GROUP BY tb_providers.name "; $query=mysqli_query($mysqli, $sql); echo mysqli_error($mysqli); $json=array(); while ($row=mysqli_fetch_array($query)){ $json[]=array('Name_Proyecto'=>$row[0], 'code'=>"$".number_format($row[1],2));} header('Content-Type:application/json'); echo json_encode($json) ;}
